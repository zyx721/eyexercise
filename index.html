<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Eye Exercise App</title>
    <style>
        :root {
            --ball-color: #00aaff;
        }
        html, body {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background-color: #111;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: #ccc;
        }
        #vr-container { display: flex; width: 100vw; height: 100vh; position: relative; }
        .eye-section { flex: 1; height: 100%; position: relative; background-color: #222; box-sizing: border-box; border: 1px solid #444; }
        .divider { position: absolute; left: 50%; top: 0; width: 4px; height: 100%; background-color: #000; transform: translateX(-50%); }
        .ball {
            position: absolute;
            top: 50%;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            background: 
                radial-gradient(circle at 35% 35%, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0) 25%),
                radial-gradient(circle at 70% 80%, var(--ball-color) 0%, #000 150%);
            box-shadow: inset -5px -5px 20px rgba(0,0,0,0.4), 0 0 10px var(--ball-color);
        }
        .instructions { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background-color: rgba(0, 0, 0, 0.5); padding: 10px 20px; border-radius: 10px; text-align: center; z-index: 10; }
        #fullscreen-btn { display: none; position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 20; padding: 12px 24px; font-size: 16px; font-weight: bold; color: #fff; background-color: rgba(0, 170, 255, 0.7); border: none; border-radius: 30px; cursor: pointer; backdrop-filter: blur(5px); }
        .controls-panel {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 12px;
            display: flex;
            gap: 20px;
            align-items: center;
            z-index: 20;
            backdrop-filter: blur(5px);
            border: 1px solid #444;
        }
        .control-group { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .control-group label { font-size: 14px; white-space: nowrap; }
        input[type="range"] { width: 100px; }
        input[type="color"] { width: 40px; height: 25px; border: none; background: none; padding: 0; border-radius: 5px; }
        @media (max-width: 1023px) {
            .controls-panel { flex-direction: column; bottom: 80px; }
            #fullscreen-btn { display: block; }
        }
    </style>
</head>
<body>
    <div class="instructions"><h2>Eye Exercise</h2><p>Relax and follow the balls with your eyes.</p></div>
    <div id="vr-container">
        <div class="eye-section"><div class="ball" id="left-ball"></div></div>
        <div class="eye-section"><div class="ball" id="right-ball"></div></div>
        <div class="divider"></div>
    </div>
    <div class="controls-panel">
        <div class="control-group"><label for="speed-slider">Speed</label><input type="range" id="speed-slider" min="1" max="10" value="4"></div>
        <div class="control-group"><label for="size-slider">Size</label><input type="range" id="size-slider" min="20" max="100" value="60"></div>
        <div class="control-group"><label for="color-picker">Color</label><input type="color" id="color-picker" value="#00aaff"></div>
    </div>
    <button id="fullscreen-btn">Go Fullscreen</button>

    <script>
        const leftBall = document.getElementById('left-ball');
        const rightBall = document.getElementById('right-ball');
        const speedSlider = document.getElementById('speed-slider');
        const sizeSlider = document.getElementById('size-slider');
        const colorPicker = document.getElementById('color-picker');
        const docElement = document.documentElement;

        let animationDuration = 7000;
        let baseSize = 60; 
        const MIN_SIZE_SCALE = 0.4; // Ball shrinks to 40% of its base size
        let startTime = null;

        function updateSpeed() { animationDuration = 11000 - (parseInt(speedSlider.value) * 1000); }
        function updateSize() { baseSize = parseInt(sizeSlider.value); }
        function updateColor() { docElement.style.setProperty('--ball-color', colorPicker.value); }
        
        updateSpeed(); updateSize(); updateColor();
        
        speedSlider.addEventListener('input', updateSpeed);
        sizeSlider.addEventListener('input', updateSize);
        colorPicker.addEventListener('input', updateColor);

        function animate(timestamp) {
            if (!startTime) startTime = timestamp;
            
            // To start in the middle, we offset the elapsed time by a quarter cycle
            const timeOffset = animationDuration / 4;
            const elapsedTime = timestamp - startTime + timeOffset;

            // --- MOVEMENT LOGIC (Unchanged) ---
            // This creates the left-to-right-to-left movement
            const moveCycleProgress = (elapsedTime % animationDuration) / animationDuration;
            const movementFactor = (1 - Math.cos(moveCycleProgress * 2 * Math.PI)) / 2;
            const percentX = movementFactor * 100;

            // --- CORRECTED SIZING LOGIC ---
            // We use a simple sine wave for the size. It naturally creates one "pulse"
            // per full animation cycle, perfectly matching the movement.
            const sizeCycleProgress = (elapsedTime % animationDuration) / animationDuration;
            const sizeFactor = Math.sin(sizeCycleProgress * Math.PI);

            // Calculate the current size based on the sine wave (sizeFactor from 0 to 1)
            const sizeRange = baseSize - (baseSize * MIN_SIZE_SCALE);
            const currentSize = (baseSize * MIN_SIZE_SCALE) + (sizeFactor * sizeRange);
            
            // --- APPLY STYLES ---
            const balls = [leftBall, rightBall];
            balls.forEach(ball => {
                ball.style.width = `${currentSize}px`;
                ball.style.height = `${currentSize}px`;
            });

            leftBall.style.left = `${percentX}%`;
            rightBall.style.left = `${100 - percentX}%`;
            
            requestAnimationFrame(animate);
        }

        const fullscreenBtn = document.getElementById('fullscreen-btn');
        fullscreenBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) { docElement.requestFullscreen?.(); } 
            else { document.exitFullscreen?.(); }
        });

        requestAnimationFrame(animate);
    </script>
</body>
</html>